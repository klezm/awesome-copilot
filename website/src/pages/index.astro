---
import StarlightPage from '@astrojs/starlight/components/StarlightPage.astro';
import { getCollection } from 'astro:content';

const allDocs = await getCollection('docs');
---
<StarlightPage frontmatter={{ title: 'Template Collection' }}>
  <div class="w-full">
  <div class="mb-8">
    <input
      type="search"
      id="search-input"
      placeholder="Search templates..."
      class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-accent-500"
    />
  </div>
  <div class="flex space-x-2 mb-8">
    <button id="filter-all" class="px-4 py-2 rounded-md bg-accent-500 text-white">All</button>
    <button id="filter-chatmodes" class="px-4 py-2 rounded-md bg-blue-200 text-blue-800">Chatmodes</button>
    <button id="filter-instructions" class="px-4 py-2 rounded-md bg-green-200 text-green-800">Instructions</button>
    <button id="filter-prompts" class="px-4 py-2 rounded-md bg-red-200 text-red-800">Prompts</button>
  </div>

  <div id="template-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {/*
      This is the main rendering logic for the template collection.
      We map over the `allDocs` array fetched in the frontmatter script.
      For each document, we render a "template card" with its title, description, and a link to the detail page.
      The detail pages are automatically generated by Starlight from the markdown files.
    */}
    {allDocs.map(doc => {
      const category = doc.id.split('/')[0];
      return (
        <div class="template-card" data-title={doc.data.title} data-description={doc.data.description} data-category={category}>
          <a href={`/${doc.slug}`}>
            <span class={`category-badge ${category}-badge`}>{category}</span>
            <h3>{doc.data.title}</h3>
            <p>{doc.data.description}</p>
          </a>
        </div>
      )
    })}
  </div>
</div>

<script>
  const searchInput = document.getElementById('search-input');
  const templateGrid = document.getElementById('template-grid');
  const templateCards = Array.from(templateGrid.children);

  let activeFilter = 'all';
  const filterButtons = document.querySelectorAll('button[id^="filter-"]');

  function filterTemplates() {
    const searchTerm = searchInput.value.toLowerCase();

    templateCards.forEach(card => {
      const title = card.dataset.title.toLowerCase();
      const description = card.dataset.description.toLowerCase();
      const category = card.dataset.category;

      const matchesSearch = title.includes(searchTerm) || description.includes(searchTerm);
      const matchesFilter = activeFilter === 'all' || category.startsWith(activeFilter);

      if (matchesSearch && matchesFilter) {
        card.style.display = 'flex';
      } else {
        card.style.display = 'none';
      }
    });
  }

  searchInput.addEventListener('input', filterTemplates);

  filterButtons.forEach(button => {
    button.addEventListener('click', (e) => {
      filterButtons.forEach(btn => {
        btn.classList.remove('bg-accent-500', 'text-white');
      });
      e.currentTarget.classList.add('bg-accent-500', 'text-white');
      activeFilter = e.currentTarget.id.replace('filter-', '');
      filterTemplates();
    });
  });
</script>
</StarlightPage>
